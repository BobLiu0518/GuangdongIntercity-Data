<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>å¹¿ä¸œåŸé™…åˆ—è½¦æ•°æ®</title>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                margin: 40px;
                line-height: 1.6;
            }
            .container {
                max-width: 800px;
                margin: 0 auto;
            }
            .date-folder {
                margin: 20px 0;
                padding: 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                background: #fafafa;
            }
            .file-list {
                margin: 10px 0;
            }
            .file-link {
                display: inline-block;
                margin: 5px 10px 5px 0;
                padding: 5px 10px;
                background: #f0f0f0;
                text-decoration: none;
                border-radius: 4px;
                color: #333;
                font-size: 0.9em;
            }
            .file-link:hover {
                background: #e0e0e0;
            }
            .summary {
                background: #f8f9fa;
                padding: 15px;
                border-radius: 8px;
                margin: 20px 0;
                border-left: 4px solid #007bff;
            }
            .update-time {
                color: #666;
                font-size: 0.9em;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }
            .status-badge {
                display: inline-block;
                padding: 2px 8px;
                border-radius: 4px;
                font-size: 0.8em;
                font-weight: bold;
            }
            .status-success {
                background: #d4edda;
                color: #155724;
            }
            .status-cached {
                background: #fff3cd;
                color: #856404;
            }
            .status-error {
                background: #f8d7da;
                color: #721c24;
            }
            .loading {
                color: #666;
            }
            .error {
                color: #dc3545;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ“Š å¹¿ä¸œåŸé™…åˆ—è½¦æ•°æ®</h1>
            <p>æœ¬é¡µé¢æä¾›å¹¿ä¸œåŸé™…åˆ—è½¦çš„å®æ—¶æ•°æ®ï¼Œæ¯æ—¥è‡ªåŠ¨æ›´æ–°ã€‚æ•°æ®æ¥æºäºä¸­å›½é“è·¯12306å®˜æ–¹APIã€‚</p>

            <div class="summary">
                <h3>ğŸ“ˆ æœ€æ–°æ‰§è¡Œæ‘˜è¦</h3>
                <div id="summary-content" class="loading">åŠ è½½ä¸­...</div>
            </div>

            <h3>ğŸ“ å¯ç”¨æ•°æ®æ–‡ä»¶</h3>
            <div id="data-folders" class="loading">åŠ è½½ä¸­...</div>

            <div class="update-time">
                <p>ğŸ• æœ€åæ›´æ–°æ—¶é—´: <span id="last-update">-</span></p>
                <p>ğŸ”„ æ•°æ®è‡ªåŠ¨æ›´æ–°æ—¶é—´: æ¯æ—¥åŒ—äº¬æ—¶é—´å‡Œæ™¨ 4:00</p>
                <p>ğŸ’¾ æ•°æ®æ ¼å¼è¯´æ˜:</p>
                <ul>
                    <li><code>trains.json</code> - åˆ—è½¦ä¿¡æ¯ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰</li>
                    <li><code>stations.json</code> - ç«™ç‚¹ä¿¡æ¯ï¼ˆå¯¹è±¡æ ¼å¼ï¼‰</li>
                    <li><code>trains.map.json</code> - åˆ—è½¦ä¿¡æ¯ï¼ˆæ•°ç»„æ ¼å¼ï¼‰</li>
                    <li><code>stations.map.json</code> - ç«™ç‚¹ä¿¡æ¯ï¼ˆæ•°ç»„æ ¼å¼ï¼‰</li>
                </ul>
            </div>
        </div>

        <script>
            async function loadData() {
                try {
                    const summaryResponse = await fetch('/log.json');
                    if (summaryResponse.ok) {
                        const summary = await summaryResponse.json();

                        const updateTime = new Date(summary.executionTime).toLocaleString('zh-CN', {
                            timeZone: 'Asia/Shanghai',
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                        });
                        document.getElementById('last-update').textContent = updateTime;

                        const summaryHtml = `
                        <p><strong>æ€»å¤„ç†å¤©æ•°:</strong> ${summary.summary.total}</p>
                        <p><strong>æ–°è·å–:</strong> <span class="status-badge status-success">${summary.summary.fetched} å¤©</span></p>
                        <p><strong>ä½¿ç”¨ç¼“å­˜:</strong> <span class="status-badge status-cached">${summary.summary.cached} å¤©</span></p>
                        <p><strong>å¤±è´¥:</strong> <span class="status-badge status-error">${summary.summary.errors} å¤©</span></p>
                    `;
                        document.getElementById('summary-content').innerHTML = summaryHtml;
                    } else {
                        document.getElementById('summary-content').innerHTML = '<p class="error">æ— æ³•åŠ è½½æ‰§è¡Œæ‘˜è¦</p>';
                    }

                    const dataFolders = [];
                    const today = new Date();
                    for (let i = 0; i < 4; i++) {
                        const date = new Date(today);
                        date.setDate(date.getDate() + i);
                        const dateStr = date.toISOString().slice(0, 10).replace(/-/g, '');
                        dataFolders.push({
                            date: dateStr,
                            displayDate: date.toLocaleDateString('zh-CN', {
                                year: 'numeric',
                                month: '2-digit',
                                day: '2-digit',
                                weekday: 'short',
                            }),
                            isToday: i === 0,
                        });
                    }

                    let foldersHtml = '';
                    for (const folder of dataFolders) {
                        const files = ['trains.json', 'stations.json', 'trains.map.json', 'stations.map.json'];
                        let filesHtml = '';

                        for (const file of files) {
                            const url = `/${folder.date}/${file}`;
                            filesHtml += `<a href="${url}" class="file-link" target="_blank">${file}</a>`;
                        }

                        const todayMark = folder.isToday ? ' <span class="status-badge status-success">ä»Šå¤©</span>' : '';
                        foldersHtml += `
                        <div class="date-folder">
                            <h4>ğŸ“… ${folder.displayDate} (${folder.date})${todayMark}</h4>
                            <div class="file-list">${filesHtml}</div>
                        </div>
                    `;
                    }

                    document.getElementById('data-folders').innerHTML = foldersHtml;
                } catch (error) {
                    console.error('åŠ è½½æ•°æ®æ—¶å‡ºé”™:', error);
                    document.getElementById('summary-content').innerHTML = '<p class="error">åŠ è½½æ‘˜è¦æ•°æ®å¤±è´¥</p>';
                    document.getElementById('data-folders').innerHTML = '<p class="error">åŠ è½½æ•°æ®æ–‡ä»¶åˆ—è¡¨å¤±è´¥</p>';
                }
            }

            document.addEventListener('DOMContentLoaded', loadData);
        </script>
    </body>
</html>
